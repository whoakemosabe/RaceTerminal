import { commands } from '@/lib/commands';
import { CommandFunction } from '../index';

interface HelpCommands {
  [key: string]: CommandFunction;
}

// Command-specific help documentation
const commandHelp: Record<string, string> = {
  'theme': [
    'üé® THEME COMMAND REFERENCE',
    '‚ïê'.repeat(50),
    '',
    'Change terminal color scheme and appearance.',
    '',
    'Usage: /theme <name>',
    'Examples:',
    '‚Ä¢ /theme ferrari - Apply Ferrari team colors',
    '‚Ä¢ /theme dracula - Use Dracula editor theme',
    '‚Ä¢ /theme calc amber - Enable calculator mode with amber display',
    '',
    'Available Themes:',
    '',
    '1. F1 Team Themes',
    '   ‚Ä¢ All current F1 teams (e.g., ferrari, mercedes)',
    '   ‚Ä¢ Team-specific colors and branding',
    '   ‚Ä¢ Authentic racing aesthetics',
    '',
    '2. Editor Themes',
    '   ‚Ä¢ dracula - Dark theme with purple accents',
    '   ‚Ä¢ monokai - Dark theme with vibrant accents',
    '   ‚Ä¢ nord - Arctic-inspired dark theme',
    '   ‚Ä¢ tokyo-night - Clean dark theme inspired by Tokyo',
    '   ‚Ä¢ solarized - Precision colors for machines and people',
    '   ‚Ä¢ github-dark - GitHub dark theme',
    '   ‚Ä¢ gruvbox - Retro groove color scheme',
    '   ‚Ä¢ material - Material design inspired theme',
    '',
    '3. Calculator Themes',
    '   Usage: /theme calc <scheme>',
    '   ‚Ä¢ classic - Traditional green LCD',
    '   ‚Ä¢ blue - Cool blue display',
    '   ‚Ä¢ amber - Warm amber screen',
    '   ‚Ä¢ red - Red LED display',
    '   ‚Ä¢ white - Modern LCD look',
    '',
    'Reset Theme:',
    '‚Ä¢ /theme default - Restore default terminal colors',
    '',
    'Notes:',
    '‚Ä¢ Themes persist between sessions',
    '‚Ä¢ Each theme includes:',
    '  - Primary and secondary colors',
    '  - Background and text colors',
    '  - Border and accent colors',
    '  - Terminal history colors',
    '',
    'Related Commands:',
    '‚Ä¢ /retro - Retro text effects',
    '‚Ä¢ /matrix - Matrix effects',
    '‚Ä¢ /crt - CRT monitor effects',
    '‚Ä¢ /calc - Calculator mode'
  ].join('\n'),

  'colors': [
    'üé® CALCULATOR COLOR SCHEMES REFERENCE',
    '‚ïê'.repeat(50),
    '',
    'Change calculator display color scheme.',
    '',
    'Usage: /colors calc [scheme]',
    'Example: /colors calc amber',
    '',
    'Available Schemes:',
    '‚Ä¢ classic - Classic green LCD display',
    '‚Ä¢ blue   - Cool blue LCD screen',
    '‚Ä¢ amber  - Warm amber display',
    '‚Ä¢ red    - Red LED display',
    '‚Ä¢ white  - Modern LCD look',
    '',
    'Features:',
    '‚Ä¢ Multiple color themes',
    '‚Ä¢ Authentic LCD styling',
    '‚Ä¢ Customizable text colors',
    '‚Ä¢ Scan line effects',
    '',
    'Notes:',
    '‚Ä¢ Each scheme has unique colors for:',
    '  - Background',
    '  - Text output',
    '  - Commands',
    '  - Timestamps',
    '  - Prompts',
    '',
    'Related Commands:',
    '‚Ä¢ /calc - Toggle calculator mode',
    '‚Ä¢ /theme - Change terminal theme',
    '‚Ä¢ /retro - Retro text effects'
  ].join('\n'),

  'calculator': [
    'üñ© CALCULATOR MODE REFERENCE',
    '‚ïê'.repeat(50),
    '',
    'Enable retro calculator LCD display mode.',
    '',
    'Usage:',
    '1. Basic toggle: /calc',
    '2. With colors: /colors calc [scheme]',
    '',
    'Features:',
    '‚Ä¢ Retro LCD display effect',
    '‚Ä¢ Multiple color schemes',
    '‚Ä¢ Subtle scan lines',
    '‚Ä¢ Vintage calculator aesthetics',
    '‚Ä¢ Authentic LCD styling',
    '',
    'Color Schemes:',
    '‚Ä¢ classic - Traditional green LCD',
    '‚Ä¢ blue    - Cool blue display',
    '‚Ä¢ amber   - Warm amber screen',
    '‚Ä¢ red     - Red LED display',
    '‚Ä¢ white   - Modern LCD look',
    '',
    'Related Commands:',
    '‚Ä¢ /colors calc - Change calculator colors',
    '‚Ä¢ /retro - Retro text effects',
    '‚Ä¢ /theme - Terminal themes'
  ].join('\n'),

  'stats': [
    'üìä TERMINAL STATISTICS REFERENCE',
    '‚ïê'.repeat(50),
    '',
    'View detailed terminal usage statistics.',
    '',
    'Usage: /stats',
    '',
    'Displayed Information:',
    '‚Ä¢ Command usage frequency',
    '‚Ä¢ Most used commands',
    '‚Ä¢ Session duration',
    '‚Ä¢ Data retrieved',
    '‚Ä¢ System performance',
    '',
    'Notes:',
    '‚Ä¢ Statistics persist between sessions',
    '‚Ä¢ Tracks command history',
    '‚Ä¢ Shows performance metrics'
  ].join('\n'),

  'sys': [
    'üñ•Ô∏è  SYSTEM COMMAND REFERENCE',
    '‚ïê'.repeat(50),
    '',
    'View comprehensive system information and diagnostics.',
    '',
    'Usage: /sys',
    '',
    'Displayed Information:',
    '',
    '1. System Info',
    '   ‚Ä¢ OS and kernel version',
    '   ‚Ä¢ Terminal version',
    '   ‚Ä¢ Shell environment',
    '',
    '2. Theme & Display',
    '   ‚Ä¢ Current theme',
    '   ‚Ä¢ Font size',
    '   ‚Ä¢ Calculator mode status',
    '   ‚Ä¢ Active visual effects',
    '',
    '3. Performance',
    '   ‚Ä¢ Session uptime',
    '   ‚Ä¢ Memory usage',
    '   ‚Ä¢ Screen resolution',
    '',
    '4. Environment',
    '   ‚Ä¢ Protocol',
    '   ‚Ä¢ Connection status',
    '   ‚Ä¢ User agent',
    '',
    'Features:',
    '‚Ä¢ Real-time system monitoring',
    '‚Ä¢ Comprehensive diagnostics',
    '‚Ä¢ Performance metrics',
    '‚Ä¢ Environment details',
    '',
    'Notes:',
    '‚Ä¢ Updates in real-time',
    '‚Ä¢ Shows all active effects',
    '‚Ä¢ Displays current theme',
    '',
    'Related Commands:',
    '‚Ä¢ /theme - Change terminal theme',
    '‚Ä¢ /fontsize - Adjust text size',
    '‚Ä¢ /clear - Clear terminal history'
  ].join('\n'),

  'decrypt': [
    'üîì DECRYPTION GAME REFERENCE',
    '‚ïê'.repeat(50),
    '',
    'Play an interactive code-breaking minigame.',
    '',
    'Usage: /decrypt',
    '',
    'Game Features:',
    '‚Ä¢ Multiple difficulty levels',
    '‚Ä¢ Timed challenges',
    '‚Ä¢ Score tracking',
    '‚Ä¢ Progressive difficulty',
    '',
    'Notes:',
    '‚Ä¢ Use logic to crack codes',
    '‚Ä¢ Limited attempts per puzzle',
    '‚Ä¢ Includes tutorial mode',
    '',
    'Related Commands:',
    '‚Ä¢ /hack - Hacking simulation',
    '‚Ä¢ /matrix - Matrix effects',
    '‚Ä¢ /glitch - Glitch effects'
  ].join('\n'),

  'telemetry': [
    'üìä TELEMETRY COMMAND REFERENCE',
    '‚ïê'.repeat(50),
    '',
    'Get real-time car telemetry data during active sessions.',
    '',
    'Usage: /telemetry <driver_number>',
    'Example: /telemetry 44',
    '',
    'Available Data:',
    '‚Ä¢ Speed (km/h)',
    '‚Ä¢ RPM',
    '‚Ä¢ Throttle position (%)',
    '‚Ä¢ Brake position (%)',
    '‚Ä¢ Gear',
    '‚Ä¢ Engine temperature',
    '',
    'Notes:',
    '‚Ä¢ Only available during active sessions',
    '‚Ä¢ Updates in real-time',
    '‚Ä¢ Use driver numbers (e.g., 1, 44, 16)',
    '',
    'Related Commands:',
    '‚Ä¢ /live - Live timing data',
    '‚Ä¢ /tires - Tire compound data',
    '‚Ä¢ /weather - Track conditions'
  ].join('\n'),

  'live': [
    'üìä LIVE TIMING COMMAND REFERENCE',
    '‚ïê'.repeat(50),
    '',
    'Get real-time timing data during active sessions.',
    '',
    'Usage: /live',
    '',
    'Available Data:',
    '‚Ä¢ Position',
    '‚Ä¢ Last lap time',
    '‚Ä¢ Sector times (S1, S2, S3)',
    '‚Ä¢ Speed trap',
    '',
    'Notes:',
    '‚Ä¢ Only available during active sessions',
    '‚Ä¢ Updates automatically',
    '‚Ä¢ Shows top 10 drivers by default',
    '',
    'Related Commands:',
    '‚Ä¢ /telemetry - Car telemetry',
    '‚Ä¢ /status - Track status',
    '‚Ä¢ /weather - Track conditions'
  ].join('\n'),

  'weather': [
    'üå§Ô∏è WEATHER COMMAND REFERENCE',
    '‚ïê'.repeat(50),
    '',
    'Get current weather conditions at the circuit.',
    '',
    'Usage: /weather',
    'Shortcuts: /w, /wx',
    '',
    'Available Data:',
    '‚Ä¢ Track status',
    '‚Ä¢ Air temperature',
    '‚Ä¢ Track temperature',
    '‚Ä¢ Humidity',
    '‚Ä¢ Pressure',
    '‚Ä¢ Wind speed & direction',
    '‚Ä¢ Rainfall',
    '',
    'Notes:',
    '‚Ä¢ Only available during race weekends',
    '‚Ä¢ Updates in real-time',
    '‚Ä¢ Includes track status indicators',
    '',
    'Related Commands:',
    '‚Ä¢ /status - Track status',
    '‚Ä¢ /live - Live timing',
    '‚Ä¢ /telemetry - Car telemetry'
  ].join('\n'),

  'pace': [
    'üìä RACE PACE ANALYSIS REFERENCE',
    '‚ïê'.repeat(50),
    '',
    'Analyze detailed race pace and consistency.',
    '',
    'Usage: /pace <year> <round>',
    'Example: /pace 2023 1',
    '',
    'Available Data:',
    '‚Ä¢ Average lap times',
    '‚Ä¢ Stint performance',
    '‚Ä¢ Tire management',
    '‚Ä¢ Consistency metrics',
    '‚Ä¢ Performance trends',
    '',
    'Features:',
    '‚Ä¢ Detailed stint analysis',
    '‚Ä¢ Tire degradation tracking',
    '‚Ä¢ Performance ratings',
    '‚Ä¢ Lap time consistency',
    '',
    'Performance Ratings:',
    '‚Ä¢ üí´ Outstanding',
    '‚Ä¢ üü¢ Strong',
    '‚Ä¢ üü° Fair',
    '‚Ä¢ üî¥ Poor',
    '',
    'Related Commands:',
    '‚Ä¢ /gap - Race gap analysis',
    '‚Ä¢ /sector - Sector analysis',
    '‚Ä¢ /overtake - Overtaking analysis'
  ].join('\n'),

  'gap': [
    'üìä RACE GAP ANALYSIS REFERENCE',
    '‚ïê'.repeat(50),
    '',
    'Analyze race intervals and battles.',
    '',
    'Usage: /gap <year> <round>',
    'Example: /gap 2023 1',
    '',
    'Available Data:',
    '‚Ä¢ Intervals between drivers',
    '‚Ä¢ Gap to leader',
    '‚Ä¢ Position changes',
    '‚Ä¢ Battle analysis',
    '',
    'Features:',
    '‚Ä¢ Real-time gap tracking',
    '‚Ä¢ Consistency ratings',
    '‚Ä¢ Battle identification',
    '‚Ä¢ Performance trends',
    '',
    'Consistency Ratings:',
    '‚Ä¢ üü¢ High (¬±0.5s)',
    '‚Ä¢ üü° Medium (¬±1.0s)',
    '‚Ä¢ üî¥ Low (>¬±1.0s)',
    '',
    'Related Commands:',
    '‚Ä¢ /pace - Race pace analysis',
    '‚Ä¢ /sector - Sector analysis',
    '‚Ä¢ /overtake - Overtaking analysis'
  ].join('\n'),

  'compare': [
    'üèÜ COMPARISON COMMAND REFERENCE',
    '‚ïê'.repeat(50),
    '',
    '',
    'Compare career statistics between drivers or teams.',
    '',
    'Usage:',
    '1. Compare Drivers:',
    '   /compare driver <driver1> <driver2>',
    '   Shortcut: /md <driver1> <driver2>',
    '',
    '2. Compare Teams:',
    '   /compare team <team1> <team2>',
    '   Shortcut: /mt <team1> <team2>',
    '',
    'Examples:',
    '‚Ä¢ /compare driver verstappen hamilton',
    '‚Ä¢ /md verstappen hamilton',
    '‚Ä¢ /compare team redbull mercedes',
    '‚Ä¢ /mt redbull mercedes',
    '',
    'Available Statistics:',
    '‚Ä¢ Championships',
    '‚Ä¢ Race wins',
    '‚Ä¢ Podiums',
    '‚Ä¢ Pole positions',
    '‚Ä¢ Fastest laps',
    '‚Ä¢ Points',
    '‚Ä¢ Win rate',
    '‚Ä¢ Podium rate',
    '',
    'Notes:',
    '‚Ä¢ Use driver names, codes, or numbers',
    '‚Ä¢ Team names and abbreviations supported',
    '‚Ä¢ Historical data included',
    '',
    'Related Commands:',
    '‚Ä¢ /driver - Driver information',
    '‚Ä¢ /team - Team information',
    '‚Ä¢ /standings - Championship standings'
  ].join('\n'),

  'sector': [
    'üìä QUALIFYING SECTOR ANALYSIS REFERENCE',
    '‚ïê'.repeat(50),
    '',
    'Analyze qualifying sector time comparisons.',
    '',
    'Usage: /sector <year> <round>',
    'Example: /sector 2023 1',
    'Shortcut: /sa',
    '',
    'Available Data:',
    '‚Ä¢ Sector time comparisons',
    '‚Ä¢ Theoretical best lap',
    '‚Ä¢ Purple/green/yellow sectors',
    '‚Ä¢ Time lost to ideal lap',
    '‚Ä¢ Session improvements',
    '',
    'Features:',
    '‚Ä¢ Detailed sector breakdowns',
    '‚Ä¢ Performance indicators',
    '‚Ä¢ Improvement tracking',
    '‚Ä¢ Visual sector markers',
    '',
    'Notes:',
    '‚Ä¢ Purple: Fastest sector',
    '‚Ä¢ Green: Within 1% of fastest',
    '‚Ä¢ Yellow: Within 2% of fastest',
    '‚Ä¢ White: Over 2% off fastest',
    '',
    'Related Commands:',
    '‚Ä¢ /qualifying - Full Q1/Q2/Q3 results',
    '‚Ä¢ /gap - Race gap analysis',
    '‚Ä¢ /pace - Race pace analysis'
  ].join('\n'),

  'overtake': [
    'üèéÔ∏è OVERTAKING ANALYSIS REFERENCE',
    '‚ïê'.repeat(50),
    '',
    'Analyze race overtaking statistics.',
    '',
    'Usage: /overtake <year> <round>',
    'Example: /overtake 2023 1',
    'Shortcuts: /oa, /ov',
    '',
    'Available Data:',
    '‚Ä¢ Position changes',
    '‚Ä¢ DRS vs non-DRS moves',
    '‚Ä¢ Defensive statistics',
    '‚Ä¢ Key overtaking moments',
    '',
    'Features:',
    '‚Ä¢ Detailed move tracking',
    '‚Ä¢ DRS effectiveness',
    '‚Ä¢ Defense ratings',
    '‚Ä¢ Lap-by-lap analysis',
    '',
    'Performance Ratings:',
    '‚Ä¢ üü£ Exceptional (5+ overtakes)',
    '‚Ä¢ üü¢ Strong (3-4 overtakes)',
    '‚Ä¢ üü° Active (1-2 overtakes)',
    '‚Ä¢ ‚ö™ Limited (0 overtakes)',
    '',
    'Defense Ratings:',
    '‚Ä¢ üü¢ Clean Race (no positions lost)',
    '‚Ä¢ üü¢ Solid (1-2 positions lost)',
    '‚Ä¢ üü° Under Pressure (3-4 positions lost)',
    '‚Ä¢ üî¥ Defensive (5+ positions lost)',
    '',
    'Related Commands:',
    '‚Ä¢ /race - Full race results',
    '‚Ä¢ /gap - Race gap analysis',
    '‚Ä¢ /pace - Race pace analysis'
  ].join('\n'),
    'üìä QUALIFYING SECTOR ANALYSIS REFERENCE',
    '‚ïê'.repeat(50),
    '',
    'Analyze qualifying sector time comparisons.',
    '',
    'Usage: /sector <year> <round>',
    'Example: /sector 2023 1',
    'Shortcut: /sa',
    '',
    'Available Data:',
    '‚Ä¢ Sector time comparisons',
    '‚Ä¢ Theoretical best lap',
    '‚Ä¢ Purple/green/yellow sectors',
    '‚Ä¢ Time lost to ideal lap',
    '‚Ä¢ Session improvements',
    '',
    'Features:',
    '‚Ä¢ Detailed sector breakdowns',
    '‚Ä¢ Performance indicators',
    '‚Ä¢ Improvement tracking',
    '‚Ä¢ Visual sector markers',
    '',
    'Notes:',
    '‚Ä¢ Purple: Fastest sector',
    '‚Ä¢ Green: Within 1% of fastest',
    '‚Ä¢ Yellow: Within 2% of fastest',
    '‚Ä¢ White: Over 2% off fastest',
    '',
    'Related Commands:',
    '‚Ä¢ /qualifying - Full Q1/Q2/Q3 results',
    '‚Ä¢ /gap - Race gap analysis',
    '‚Ä¢ /pace - Race pace analysis'
  ].join('\n'),

  'overtake': [
    'üèéÔ∏è OVERTAKING ANALYSIS REFERENCE',
    '‚ïê'.repeat(50),
    '',
    'Analyze race overtaking statistics.',
    '',
    'Usage: /overtake <year> <round>',
    'Example: /overtake 2023 1',
    'Shortcuts: /oa, /ov',
    '',
    'Available Data:',
    '‚Ä¢ Position changes',
    '‚Ä¢ DRS vs non-DRS moves',
    '‚Ä¢ Defensive statistics',
    '‚Ä¢ Key overtaking moments',
    '',
    'Features:',
    '‚Ä¢ Detailed move tracking',
    '‚Ä¢ DRS effectiveness',
    '‚Ä¢ Defense ratings',
    '‚Ä¢ Lap-by-lap analysis',
    '',
    'Performance Ratings:',
    '‚Ä¢ üü£ Exceptional (5+ overtakes)',
    '‚Ä¢ üü¢ Strong (3-4 overtakes)',
    '‚Ä¢ üü° Active (1-2 overtakes)',
    '‚Ä¢ ‚ö™ Limited (0 overtakes)',
    '',
    'Defense Ratings:',
    '‚Ä¢ üü¢ Clean Race (no positions lost)',
    '‚Ä¢ üü¢ Solid (1-2 positions lost)',
    '‚Ä¢ üü° Under Pressure (3-4 positions lost)',
    '‚Ä¢ üî¥ Defensive (5+ positions lost)',
    '',
    'Related Commands:',
    '‚Ä¢ /race - Full race results',
    '‚Ä¢ /gap - Race gap analysis',
    '‚Ä¢ /pace - Race pace analysis'
  ].join('\n'),

  'effects': [
    '‚ú® VISUAL EFFECTS COMMAND REFERENCE',
    '‚ïê'.repeat(50),
    '',
    'Available Effects Commands:',
    '',
    '1. /retro',
    '   ‚Ä¢ Toggle retro text glow effect',
    '   ‚Ä¢ Usage: /retro [all|reset]',
    '',
    '2. /matrix',
    '   ‚Ä¢ Toggle Matrix-style digital rain',
    '   ‚Ä¢ Usage: /matrix',
    '',
    '3. /crt',
    '   ‚Ä¢ Toggle CRT monitor effects',
    '   ‚Ä¢ Usage: /crt',
    '',
    '4. /scanlines',
    '   ‚Ä¢ Toggle scanline overlay',
    '   ‚Ä¢ Usage: /scanlines',
    '',
    '5. /glitch',
    '   ‚Ä¢ Apply temporary glitch effect',
    '   ‚Ä¢ Usage: /glitch',
    '',
    'Notes:',
    '‚Ä¢ Effects can be combined',
    '‚Ä¢ Use /retro all to enable all effects',
    '‚Ä¢ Use /retro reset to disable all effects',
    '‚Ä¢ Effects persist between sessions',
    '',
    'Related Commands:',
    '‚Ä¢ /theme - Change color theme',
    '‚Ä¢ /fontsize - Adjust text size'
  ].join('\n'),

  'list': [
    'üìã LIST COMMAND REFERENCE',
    '‚ïê'.repeat(50),
    '',
    'List available F1 data and information.',
    '',
    'Usage: /list <type>',
    'Shortcut: /ls <type>',
    '',
    'Available Types:',
    '‚Ä¢ drivers - Current drivers, champions, and legends',
    '‚Ä¢ teams - Current F1 teams and details',
    '‚Ä¢ tracks - F1 circuits and information',
    '‚Ä¢ cars - F1 cars and specifications',
    '',
    'Examples:',
    '‚Ä¢ /list drivers',
    '‚Ä¢ /list teams',
    '‚Ä¢ /ls tracks',
    '‚Ä¢ /ls cars',
    '',
    'Notes:',
    '‚Ä¢ Includes historical data',
    '‚Ä¢ Shows detailed information',
    '‚Ä¢ Supports team colors',
    '‚Ä¢ Displays country flags',
    '',
    'Related Commands:',
    '‚Ä¢ /driver - Driver details',
    '‚Ä¢ /team - Team information',
    '‚Ä¢ /track - Circuit details',
    '‚Ä¢ /car - Car specifications'
  ].join('\n')
};

const categories = {
  'Lists & Data': commands.filter(c => 
    ['list', 'ls'].some(term => 
      c.command.toLowerCase().includes(term)
    )
  ),
  'Race Information': commands.filter(c => 
    ['standings', 'schedule', 'next', 'last', 'track', 'teams', 'car'].some(term => 
      c.command.toLowerCase().includes(term)
    )
  ),
  'Live Data': commands.filter(c => 
    ['live', 'telemetry', 'status', 'weather', 'tires'].some(term => 
      c.command.toLowerCase().includes(term)
    )
  ),
  'Historical Data': commands.filter(c => 
    ['race', 'qualifying', 'sprint', 'pitstops', 'fastest', 'laps'].some(term => 
      c.command.toLowerCase().includes(term)
    )
  ),
  'Driver & Team': commands.filter(c => 
    ['driver', 'team', 'compare', '/md', '/mt'].some(term => 
      c.command.toLowerCase().includes(term)
    )
  ),
    ['user', 'clear', 'help', 'theme', 'sys', 'neofetch', 'hack', 'fontsize', 'stats', 'decrypt', 'reset'].some(term => 
      c.command.toLowerCase().includes(term) ||
      (c.category?.toLowerCase() === 'system')
    )
  ),
  'Effects': commands.filter(c => 
    ['retro', 'matrix', 'crt', 'glitch', 'scanlines', 'rain'].some(term => 
      c.command.toLowerCase().includes(term) ||
      (c.category?.toLowerCase() === 'effects')
    )
  ).concat(commands.filter(c => 
    ['calc', 'calculator'].some(term => 
      c.command.toLowerCase().includes(term) ||
      (c.category?.toLowerCase() === 'effects')
    )
  ))
};

const formatCommand = (cmd: typeof commands[0]) => {
  const [baseCmd, ...params] = cmd.command.split(' ');
  const aliases = baseCmd.match(/\((.*?)\)/)?.[1] || '';
  const cleanCmd = baseCmd.replace(/\s*\(.*?\)/, '');
  
  return [
    `${cleanCmd}${params.length ? ' ' + params.join(' ') : ''}`,
    aliases ? `Aliases: ${aliases}` : '',
    `Description: ${cmd.description}`,
    `Source: ${cmd.source}`,
    ''
  ].filter(Boolean).join('\n');
};

export const helpCommands: HelpCommands = {
  '/help': async (args: string[]) => {
    // If a specific command is provided
    if (args[0]) {
      const searchTerm = args[0].toLowerCase().replace('/', '');
      
      // Check for direct command help
      if (commandHelp[searchTerm]) {
        return commandHelp[searchTerm];
      }

      // Check for category help
      const category = Object.entries(categories).find(([name]) => 
        name.toLowerCase().includes(searchTerm)
      );

      if (category) {
        return [
          `üìö ${category[0].toUpperCase()} COMMANDS`,
          '‚ïê'.repeat(50),
          '',
          ...category[1].map(formatCommand)
        ].join('\n');
      }

      return [
        '‚ùå Help topic not found. Try one of these:',
        '',
        'Categories:',
        ...Object.keys(categories).map(cat => `‚Ä¢ ${cat}`),
        '',
        'Popular Commands:',
        '‚Ä¢ telemetry - Car telemetry data',
        '‚Ä¢ live - Live timing information',
        '‚Ä¢ weather - Track conditions',
        '‚Ä¢ compare - Compare drivers/teams',
        '‚Ä¢ effects - Visual effects',
        '‚Ä¢ list - Available data'
      ].join('\n');
    }

    const header = [
      'üìö RACETERMINAL PRO COMMAND REFERENCE',
      '‚ïê'.repeat(50),
      '',
      'All available commands by category:',
      ''
    ];

    const content = [
      'üèÅ RACE INFORMATION',
      '‚ïê'.repeat(50),
      '/standings (/s) - View current Formula 1 Drivers Championship standings',
      '/teams (/cs) - View current Formula 1 Constructors Championship standings',
      '/schedule (/sc) - View 2024 Formula 1 race calendar and schedule',
      '/next (/n) - View details and countdown for the next Formula 1 race',
      '/last - View results from the most recent Formula 1 race',
      '/track (/t) <name> - View Formula 1 circuit details, layout, and records',
      '/car (/c) <name|year> - View Formula 1 car specifications and performance data',
      '',
      'üìä LIVE DATA',
      '‚ïê'.repeat(50),
      '/live (/l) - View real-time Formula 1 timing and positions',
      '/telemetry <number> - View live Formula 1 car telemetry by driver number',
      '/status - View current Formula 1 track status and flags',
      '/weather (/w) - View current weather conditions at Formula 1 circuit',
      '/tires <number> - View Formula 1 tire compound and wear by driver number',
      '',
      'üìÖ HISTORICAL DATA',
      '‚ïê'.repeat(50),
      '/race (/r) <year> [round] - View historical Formula 1 race results',
      '/qualifying (/q) <year> <round> - View Formula 1 qualifying results',
      '/sprint (/sp) <year> <round> - View Formula 1 sprint race results',
      '/pitstops (/p) <year> <round> - View Formula 1 pit stop timings',
      '/fastest (/f) <year> <round> - View fastest lap records',
      '/laps <year> <round> [driver] - View detailed Formula 1 lap times',
      '',
      'üìà ANALYSIS',
      '‚ïê'.repeat(50),
      '/pace <year> <round> - Analyze detailed race pace and consistency',
      '/gap <year> <round> - View detailed race gap analysis',
      '/sector (/sa) <year> <round> - Analyze qualifying sector times and comparisons',
      '/overtake (/oa, /ov) <year> <round> - Analyze race overtaking statistics',
      '/plot <year> <round> <driver> - Generate ASCII lap time progression chart',
      '/compare (/m) <type> <name1> <name2> - Compare driver or team statistics',
      '/md <driver1> <driver2> - Quick driver comparison shortcut',
      '/mt <team1> <team2> - Quick team comparison shortcut',
      '',
      'üë§ DRIVER & TEAM',
      '‚ïê'.repeat(50),
      '/driver (/d) <name> - View F1 driver details, stats, and career info',
      '/team <name> - View F1 team history, achievements, and details',
      '',
      '‚ú® EFFECTS',
      '‚ïê'.repeat(50),
      '/retro - Toggle retro terminal text glow effect',
      '/matrix - Toggle Matrix-style terminal effects',
      '/matrix rain - Toggle Matrix digital rain background effect',
      '/crt - Toggle CRT monitor visual effects',
      '/scanlines - Toggle CRT scanlines overlay',
      '/glitch - Apply temporary glitch visual effect',
      '/calc - Toggle retro calculator LCD display effect',
      '',
      '‚öôÔ∏è SYSTEM',
      '‚ïê'.repeat(50),
      '/user (/u) <name|reset> - Set your terminal username or reset to default',
      '/clear - Clear terminal history and output (Ctrl+L)',
      '/help (/h) - Show detailed help and command reference',
      '/theme <name> - Change terminal colors to F1 team theme',
      '/fontsize <size|+|-|reset> - Adjust terminal text size',
      '/sys - View system info and terminal diagnostics',
      '/neofetch - View system info in stylized terminal format',
      '/hack <target> - Run simulated hacking sequence with effects',
      '/decrypt - Play interactive code-breaking minigame',
      '/stats - View your terminal usage statistics',
      '',
      'üìã DATA LISTS',
      '‚ïê'.repeat(50),
      '/list (/ls) drivers - List all F1 drivers (current and historical)',
      '/list (/ls) teams - List all F1 teams and details',
      '/list (/ls) tracks - List all F1 circuits and information',
      '/list (/ls) cars - List all F1 cars and specifications'
    ];

    return [
      ...header,
      ...content,
      '',
      'Tips:',
      '‚Ä¢ Use /list <type> to see available data (drivers, teams, tracks, cars)',
      '‚Ä¢ Use Tab for command completion',
      '‚Ä¢ Commands are case-insensitive',
      '‚Ä¢ Most commands have shortcuts (shown in parentheses)',
      '‚Ä¢ Press Alt+Enter to toggle fullscreen mode',
      '‚Ä¢ Press Ctrl+L to clear the terminal'
    ].join('\n');
  }
};